version: "3.3"

services:

  ########################### base images: ###########################



  base:
    build: base
  basepythonnodejs:
    build: basepythonnodejs
  basescala:
    build: basescala



  ########################### databases: ###########################



  couchlocal:
    image: klaemo/couchdb:1.6.1
    ports:
      - "5984:5984"
    expose:
      - "5984"
    volumes:
      - $II_CLONE_PATH/dockerdata/couchdb:/usr/local/var/lib/couchdb
  couchproxy:
    build: couchproxy
    environment:
      CLOUDANT_USERNAME:
      CLOUDANT_AUTHORIZATION_HEADER:
  postgres:
    image: "postgres:9.5"
    environment:
      POSTGRES_PASSWORD: asdf
    volumes:
    - /dockerdata/postgres:/var/lib/postgresql/data



  ########################### services: ###########################

  scheduler:
    build:
      context: scheduler
      args:
        github_username: "${GITHUB_USERNAME}"
        github_access_token: "${GITHUB_ACCESS_TOKEN}"
    links:
      - couchlocal:couch
    ports:
      - "9600:8000"

  schedulergrunt:
    build:
      context: scheduler_grunt
      args:
        github_username: "${GITHUB_USERNAME}"
        github_access_token: "${GITHUB_ACCESS_TOKEN}"
    ports:
      - "9601:9601"
      - "35729:35729"

  schedulerfrontend:
    build:
      context: scheduler_frontend
      args:
        github_username: "${GITHUB_USERNAME}"
        github_access_token: "${GITHUB_ACCESS_TOKEN}"
    ports:
      - "9602:8000"
    links:
      - scheduler:scheduler
      - postgres:postgres

  schedulerscripts:
    build:
      context: scheduler_scripts
      args:
        github_username: "${GITHUB_USERNAME}"
        github_access_token: "${GITHUB_ACCESS_TOKEN}"
    links:
      - scheduler:scheduler
      - postgres:postgres
      - couchlocal:couch
